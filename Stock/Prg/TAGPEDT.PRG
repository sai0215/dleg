PARAMETERS vact
*       *********************************************************
*       *                                                         
*       * 09/28/1993            FIL_TAG.SPR              16:29:16 
*       *                                                         
*       *********************************************************
*       *                                                         
*       * Author's Name                                           
*       *                                                         
*       * Copyright (c) 1993 Company Name                         
*       * Address                                                 
*       * City,     Zip                                           
*       *                                                         
*       * Description:                                            
*       * This program was automatically generated by GENSCRN.    
*       *                                                         
*       *********************************************************


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

IF NOT USED('empty')
	SELECT 0
	USE empty
ENDIF	


*       *********************************************************
*       *                                                         
*       *                MS-DOS Window definitions                
*       *                                                         
*       *********************************************************
*


*       *********************************************************
*       *                                                         
*       *          FIL_TAG/MS-DOS Setup Code - SECTION 2          
*       *                                                         
*       *********************************************************
*


DEFINE WINDOW tag_win FROM 1,2 TO 34,78 TITLE 'Records To '+vact FONT 'MS sans serif' ,8 STYLE 'b'
pasok = .F.
retcnt = 0
m.crtr = ''
m.cnd = ''

IF USED('def')
	SELECT def
ELSE
	SELECT 0
	USE def
ENDIF
		
COUNT TO cntfld FOR type <> 'CO' AND type <> 'LOGO' AND type <> 'BACK'
DIMENSION f[15], t[15], varary[15,4]

FOR l = 1 TO 15
	varary[l,1] = ''
ENDFOR
	
IF USED('usr')
	SELECT usr
ELSE
	SELECT 0
	USE usr
ENDIF
		
IF NOT EOF()
	crec = RECNO()
ELSE
	crec = 1
ENDIF
		
IF vact = 'DELETE'
	REPLACE ALL status WITH ' '
	SHOW GETS
ENDIF

LOCATE FOR status <> ' '
IF NOT FOUND()
	cnttag = 0
ELSE		
	cnttag = VAL(status)
	DO WHILE NOT EOF()
		CONTINUE
		cnttag = cnttag + VAL(status)
	ENDDO
ENDIF
		
REPLACE usr.copies WITH '0' FOR usr.copies ='  '

FOR l = 1 TO 15
	f[l] = 'empty.empty'
	t[l] = 0
ENDFOR	

poplnth = 20

SELECT def
GO TOP
l = 1
DO WHILE NOT EOF()
	IF type <> 'CO' AND type <> 'LOGO' AND type <> 'BACK' AND NOT (active = .F. AND empty.prfskp = .T.)
		IF poplnth + lnth > 70
			t[l] = 70-poplnth
		ELSE
			t[l] = IIF(type = 'PIC', 30, lnth)
		ENDIF	
		f[l] = "usr."+IIF(type = 'PIC', ALLTRIM(label)+'n',label)
		poplnth = poplnth + t[l]
		l = l+1
	ENDIF
	SKIP
ENDDO
f[l] = 'status'
f[l+1] = 'copies'

ACTIVATE WINDOW tag_win NOSHOW
SELECT usr

#REGION 1
FOR w=1 TO 6
	c='c'+STR(w,1)
	&c=IIF(t[w]>15 AND t[w]<>0,15,t[w])
ENDFOR

DEFINE POPUP _qjm09cc2l ;
PROMPT FIELD 'T:'+usr.status+" P:"+usr.copies+' '+SUBSTR(&f[1],1,c1)+" "+SUBSTR(&f[2],1,c2)+" "+SUBSTR(&f[3],1,c3)+" "+SUBSTR(&f[4],1,c4)+" "+SUBSTR(&f[5],1,c5)+" "+SUBSTR(&f[6],1,c6) ;
SCROLL ;
MARGIN ;
MARK ""


*       *********************************************************
*       *                                                         
*       *              FIL_TAG/MS-DOS Screen Layout               
*       *                                                         
*       *********************************************************
*

#REGION 1
@ 1,3 GET m.tag ;
 	PICTURE "@&N" ;
	POPUP _qjm09cc2l ;
	SIZE 20,poplnth ;
	FONT 'Fixedsys',9 ;
	DEFAULT crec ;
	VALID _qjm09cca8()

@ 26,3 GET m.ok ;
	PICTURE "@*HN \!OK; Tag \<All; Tag \<Rest; Tag \<Some; \<Clear All; \<Quit" ;
	SIZE 1.5,10,1 ;
	DEFAULT 1 ;
	VALID _qjm09cd6q()
	
@ 25,78 GET m.tg ;
	PICTURE "@*RHN \<Tag; \<UnTag" ;
	SIZE 1.5,4,1 ;
	DEFAULT 1 ;
	FONT 'MS SANS SERIF',8

@ 26.8,78 SAY 'Tagged Records: ' FONT 'MS SANS SERIF',8
@ 26.7,$ SAY STR(cnttag,3)+'  '


DEFINE WINDOW loc_win FROM 20,4 TO 31,62 TITLE 'CONDITION window' FONT 'ms sans serif',10 SYSTEM CLOSE
ACTIVATE WINDOW loc_win NOSHOW

*SHOW GET m.ok DISABLE 

@ 1,1 GET m.fld ;
 	PICTURE "@&N" ;
	FROM varary ;
	SIZE 4,21 ;
	DEFAULT 1 ;
	FONT "MS Sans Serif", 8 ;
	STYLE "" ;
	DISABLE

@ 1,19 GET m.cond ;
 	PICTURE "@^ =; <; >; <=; >=; <>" ;
	SIZE 4,11 ;
	DEFAULT '=' ;
	FONT "MS Sans Serif", 8 ;
	VALID tovar() ;
	STYLE "" ;
	DISABLE

@ 1,30 SAY 'CRITERIA:' ;
	FONT "MS Sans Serif", 8 ;
	STYLE "b" 
	
@ 2,30 GET m.var ;
	SIZE 1,20 ;
	FUNCTION 'k' ;
	DEFAULT " " ;
	DISABLE

@ 1,52.5 GET m.jnct ;
 	PICTURE "@^ ;AND ;OR" ;
	SIZE 4,15 ;
	DEFAULT ' ' ;
	FONT "MS Sans Serif", 8 ;
	VALID bldcrtr() ;
	STYLE "" ;
	DISABLE

ACTIVATE WINDOW tag_win

READ CYCLE ACTIVATE relloc()

RELEASE POPUPS _qjm09cc2l
RELEASE WINDOW loc_win
RELEASE WINDOW tag_win


#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF

RETURN retcnt

*       *********************************************************
*       *                                                         
*       *               FIL_TAG/MS-DOS Cleanup Code               
*       *                                                         
*       *********************************************************
*

#REGION 1
RELEASE WINDOW tag_win

FUNCTION relloc
IF WOUTPUT('tag_win')
	SHOW GET m.fld DISABLE
	SHOW GET m.cond DISABLE
	SHOW GET m.var DISABLE
	SHOW GET m.jnct DISABLE
	DO caltag
ENDIF	


*       *********************************************************
*       *                                                         
*       * _QJM09CCA8           m.tag VALID                        
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       MS-DOS                             
*       * From Screen:         FIL_TAG,     Record Number:    4   
*       * Variable:            m.tag                              
*       * Called By:           VALID Clause                       
*       * Snippet Number:      1                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _qjm09cca8     &&  m.tag VALID
#REGION 1
IF vact = 'PRINT'
  DO CASE
	CASE usr.status = " " AND m.tg = 1	
		REPLACE usr.status WITH "1"

	CASE usr.status <> " " AND m.tg = 1
		IF VAL(usr.status)+1 <100
			REPLACE usr.status WITH PADL(ALLTRIM(STR(VAL(usr.status)+1)),2,'0')
		ENDIF
		
	CASE usr.status = " " AND m.tg = 2

	CASE usr.status <> " " AND m.tg = 2
		IF VAL(usr.status)-1 >0
			REPLACE usr.status WITH PADL(ALLTRIM(STR(VAL(usr.status)-1)),2,'0')
		ELSE
			REPLACE usr.status WITH " "
		ENDIF
		
  ENDCASE		
ELSE
  DO CASE
	CASE usr.status = " " AND m.tg = 1 
		IF VAL(usr.copies)<1
			REPLACE usr.status WITH "1"
		ELSE
			IF pasok OR passw(25,3,'CHIP')
				REPLACE usr.status WITH "1"
				pasok = .T.
			ENDIF		
		ENDIF
			
	CASE usr.status = "1" AND m.tg = 2
		REPLACE usr.status WITH " "

  ENDCASE		
ENDIF


_CUROBJ = OBJNUM(m.tag)
DO caltag

RETURN

FUNCTION passw
PARAMETER m.y, m.x, m.passw
m.pass = ""
@ m.y,m.x SAY ""
FOR lp = 1 TO 4
	m.key = INKEY(0)
	IF m.key = 13	
		EXIT
	ELSE
		@ m.y,m.x+lp SAY "*"
		m.pass = m.pass	+ CHR(m.key)
	ENDIF
ENDFOR
@ m.y,m.x SAY "                "
IF UPPER(m.pass) = m.passw			
	pasok = .T.
	RETURN .T.
ELSE
	RETURN .F.
ENDIF




*       *********************************************************
*       *                                                         
*       * _QJM09CD6Q           m.ok VALID                         
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       MS-DOS                             
*       * From Screen:         FIL_TAG,     Record Number:    5   
*       * Variable:            m.ok                               
*       * Called By:           VALID Clause                       
*       * Snippet Number:      2                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _qjm09cd6q     &&  m.ok VALID
#REGION 1
DO CASE
	CASE m.ok = 1
		retcnt = cnttag
		CLEAR READ
		
	CASE m.ok = 2
		DO CASE
			CASE m.tg = 1
				REPLACE ALL usr.status WITH IIF(usr.status=' 'OR VAL(usr.status)+1>9, '1',STR(VAL(usr.status)+1,1))

			CASE m.tg = 2
				REPLACE ALL usr.status WITH IIF(usr.status=' 'OR VAL(usr.status)-1<1, ' ',STR(VAL(usr.status)-1,1))
		ENDCASE
				
		SHOW GETS
				
	CASE m.ok = 3
		DO CASE
			CASE m.tg = 1
				REPLACE usr.status WITH IIF(usr.status=' 'OR VAL(usr.status)+1>9, '1',STR(VAL(usr.status)+1,1)) FOR VAL(usr.copies)<1 

			CASE m.tg = 2
				REPLACE usr.status WITH IIF(usr.status=' 'OR VAL(usr.status)-1<1, ' ',STR(VAL(usr.status)-1,1)) FOR VAL(usr.copies)<1 
		ENDCASE
				
		SHOW GETS
				
	CASE m.ok = 4
		crtr = ''
		DO bldcond

	CASE m.ok = 5
		REPLACE ALL status WITH ' '
		SHOW GETS
		
	CASE m.ok = 6
		retcnt = 0
		CLEAR READ
				
ENDCASE

DO caltag

FUNCTION bldcond
SHOW GET m.fld ENABLE
SHOW GET m.cond ENABLE
SHOW GET m.var ENABLE
SHOW GET m.jnct ENABLE
m.res = ''
m.crtr = ''

_CUROBJ = OBJNUM(m.fld)

FUNCTION tovar
_CUROBJ = OBJNUM(m.var)

FUNCTION bldcrtr
m.crtr = m.crtr+' '+ALLTRIM(varary(m.fld,1))+' '+m.cond+" '"+ALLTRIM(m.var)+"' "+m.jnct 
@ 4.7,1 SAY m.crtr STYLE 'B'
IF EMPTY(m.jnct)
	crec = RECNO()
	REPLACE ALL status WITH '1'	FOR &crtr 
	GO crec
	SHOW GETS
ENDIF

FUNCTION caltag
crec = RECNO()

LOCATE FOR status <> ' '
IF NOT FOUND()
	cnttag = 0
ELSE		
	cnttag = VAL(status)
	DO WHILE NOT EOF()
		CONTINUE
		cnttag = cnttag + VAL(status)
	ENDDO
ENDIF

GO crec
@ 26.8,78 SAY 'Tagged Records: ' FONT 'MS SANS SERIF',8
@ 26.7,$ SAY STR(cnttag,3)+'  '
